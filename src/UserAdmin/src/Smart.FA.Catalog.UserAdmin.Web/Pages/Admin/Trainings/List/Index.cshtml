@page
@using Microsoft.Extensions.Localization
@using Smart.FA.Catalog.UserAdmin.Web.Extensions
@inject IStringLocalizer<CatalogResources> _localizer
@model Smart.FA.Catalog.UserAdmin.Web.Pages.Admin.Trainings.List.ListModel
@{
    Layout = "_AdminLayout";
    ViewData["ToolBarTitle"] = @CatalogResources.MyTrainings;
    ViewData["Title"] = CatalogResources.MyTrainings;
}

@section HeaderToolbar {
    <div class="c-toolbar">
        <div class="c-toolbar__left">
            <div class="c-toolbar__item">
                <h2 class="c-toolbar__title">@CatalogResources.MyTrainings</h2>
            </div>
        </div>

        <div class="c-toolbar__right">
            <smart-button-toolbar>
                <a href="/cfa/admin/trainings/create?fromlist=">
                    <smart-button label="@CatalogResources.AddNewTraining" leading-icon="Add"></smart-button>
                </a>
            </smart-button-toolbar>
        </div>
    </div>
}

@if (TempData.HasGlobalBannerMessage())
{
    <div class="o-container">
        <smart-spacer left="ExtraLarge" right="ExtraLarge" top="Small">
            <smart-alert style="@TempData.GetGlobalBannerMessage().Style" message="@TempData.GetGlobalBannerMessage().Message" is-closable="true"></smart-alert>
        </smart-spacer>
    </div>
}

@if (Model.Trainings is not null && !Model.Trainings.Any())
{
    <div class="c-error-page" style="height: 50%">
        <h4 class="c-error-page__title" style="font-size: 3.0rem;">@CatalogResources.YouDontHaveAnyTrainings</h4>
        <p class="c-error-page__desc" style="font-size: 2.4rem;">@CatalogResources.ClickHereToAddANewTraining</p>
        <a class="c-button c-button--secondary" href="/cfa/admin/Trainings/Create">
            <span class="c-button__content">
                <SmartIcon Icon="Icon.Add"></SmartIcon>
                <span class="c-button__label">@CatalogResources.AddNewTraining</span>
            </span>
        </a>
    </div>
}
else
{
    <div class="o-container">
        <div class="o-card-grid small-up-1 u-spacer-xl">
            @foreach (var training in Model.Trainings!)
            {
                @await Component.InvokeAsync("AdminTrainingTile", new { training = training, showDeleteButton = true })
            }
        </div>

        <div class="u-spacer-xl right">
            <div class="c-toolbar">
                <div class="c-toolbar__left">
                    @if (Model?.Trainings?.HasPreviousPage ?? false)
                    {
                        <a asp-page="/admin/trainings/list/index" asp-route-CurrentPage="@(Model.CurrentPage - 1)">@CatalogResources.Previous</a>
                    }
                </div>

                <div>Page @(Model?.CurrentPage ?? 0)/@(Model?.Trainings?.TotalPages ?? 0)</div>
                <div class="c-toolbar__right">
                    @if (Model?.Trainings?.HasNextPage ?? false)
                    {
                        <a asp-page="/admin/trainings/list/index" asp-route-CurrentPage="@(Model.CurrentPage + 1)">@CatalogResources.Next</a>
                    }
                </div>
            </div>
        </div>
    </div>
    <div id="delete-training-dialog-confirmation" class="c-dialog-context o-flex--center">
        <div class="c-dialog c-dialog--small" role="dialog">
            <div class="c-dialog__push"></div>
            <div class="c-dialog__body">
                <div class="c-dialog__content">
                    <h3 class="c-h3">@CatalogResources.YouAreAboutToDeleteTraining</h3>
                </div>
            </div>
            <div class="c-dialog__footer">
                <div class="c-toolbar c-toolbar--spaced">
                    <div class="c-toolbar__right">
                        <div class="c-toolbar__item">
                            <div class="c-button-toolbar">
                                <button class="c-button c-button--secondary" data-dialog-close="data-dialog-close">
                                    <div class="c-button__content">
                                        <div class="c-button__label">@CatalogResources.Cancel</div>
                                    </div>
                                </button>
                                <button id="delete-training-button" class="c-button c-button--primary" data-dialog-close="data-dialog-close" onclick="deleteTraining(this)">
                                    <div class="c-button__content">
                                        <smart-icon icon="Delete"></smart-icon>
                                        <div class="c-button__label">@CatalogResources.Delete</div>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="c-dialog__push"></div>
        </div>
    </div>

    @section Scripts
    {
        <script>
                // Submits the form surrounding the delete button of a training.
                function deleteTraining(elem) {
                    document.getElementById('delete-training-form-' + elem.dataset.trainingid).submit();
                }

                // Used in the AdminTrainingTile HTML.
                function setTrainingId(trainingId) {
                    document.getElementById('delete-training-button').dataset.trainingid = trainingId;
                }
            </script>
    }
}
